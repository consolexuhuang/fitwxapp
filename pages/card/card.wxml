<!--pages/card/card.wxml-->
<wxs src="../../utils/util.wxs" module="util" />
<tabBar_top navbarData = '{{navbarData}}'></tabBar_top>
<view class="wrapper" style='margin-top:{{marginTopBar}}px; padding-top:20rpx; background:#fff' wx:if='{{cardDefList}}'>
  <view wx:for="{{cardDefList}}" wx:for-item="typeItem" wx:for-index="typeKey" wx:key="typeKey">
    <view wx:if="{{typeItem.type === 3}}">
      <!-- title -->
      <view class="card-title">
        <text class="name">{{typeItem.name}}</text>
        <view class="btn" bindtap="privilegeView">
          <image class="icon" src="{{imgUrl}}card/icon_privilege.png" />
          <text>查看特权</text>
        </view>
      </view>
      <!-- card -->
      <block wx:for="{{typeItem.list}}" wx:for-item="cardItem" wx:key="index">
        <view class="card-block" bindtap="handleRechargeTap">
          <image class="card-bg fadeIn animated" src="{{cardItem.background_img}}"></image>
          <!-- 已开通信息 -->
          <view class="card-info" wx:if="{{cardItem.card_no}}">
            <text class="card-number">{{util.cardNumber(cardItem.card_no)}}</text>
            <view class="card-right">
              <text class="balance-title">当前余额</text>
              <text class="balance-number">¥{{cardItem.balance || '0.00'}}</text>
              <view class="btn">立即充值</view>
            </view>
          </view>
          <!-- 未开通信息 -->
          <view class="card-info" wx:else>
            <text class="card-info-title">开通PLUS卡专享特</text>
            <view class="card-right">
              <view class="btn mt47">立即开通</view>
            </view>
          </view>
        </view>
      </block>
    </view>
    <view wx:if="{{typeItem.type !== 3}}">
      <!-- card type -->
      <view class="card-type">
        <view class="title">
          <view class="title-name">{{typeItem.name}}类型 ({{typeItem.list.length}})</view>
          <view class="more" data-card-type="{{typeItem.type}}" bindtap="handleCardMoreTap">
            <text>更多</text>
            <text class='iconfont iconicon-test41' style='font-size:26rpx;margin-top:5rpx'/>
          </view>
        </view>
        <!-- card type list -->
        <scroll-view scroll-x class="card-type-scroll">
          <block wx:for="{{typeItem.list}}" wx:for-item="cardItem" wx:key="_PK_">
            <view class="card-type-item" data-card-id="{{cardItem._PK_}}" bindtap="handleCardTap">
              <image src="{{cardItem.background_img}}" class='fadeIn animated'/>
              <text>¥{{cardItem.discount_price}}/{{cardItem.card_total_count}}次</text>
            </view>
          </block>
        </scroll-view>
      </view>
    </view>
  </view>
</view>
<!-- 查看特权 -->
<view class="mask-swiper" hidden="{{!isShowPrivilege}}" style='padding-top:{{marginTopBar}}px'>
  <text class="close iconicon-test18 iconfont" bindtap="closePrivilege" style='top:{{marginTopBar+20}}px'></text>
  <view class="mask-main">
    <image src="{{imgUrl}}card/icon-arrow-left-white.png" class="arrow" bindtap="swiperPre"></image>
    <swiper indicator-dots="true" indicator-color="rgba(170,170,170,1)" indicator-active-color="#8B6FF1" autoplay="true" circular="true" current="{{swiperCurrentIndex}}" bindchange="swiperchange">
      <swiper-item>
        <text class="title">PLUS卡特权</text>
        <image src="{{imgUrl}}card/icon-plus-01.png" class="slide-image" />
        <text class="sub-title">PLUS卡会员权益</text>
        <text class="text" decode="true">预约课程全场95折,可叠加优惠券; \n大师课、折扣课通用(课程优惠礼包除外)</text>
      </swiper-item>
      <swiper-item>
        <text class="title">PLUS卡特权</text>
        <image src="{{imgUrl}}card/icon-plus-02.png" class="slide-image" />
        <text class="sub-title">满员等候特权</text>
        <text class="text" decode="true">Plus卡支付可自动等候满员课程,\n 补排空位,未排上自动退款</text>
      </swiper-item>
      <swiper-item>
        <text class="title">PLUS卡特权</text>
        <image src="{{imgUrl}}card/icon-plus-03.png" class="slide-image" />
        <text class="sub-title">Plus卡特权日</text>
        <text class="text" decode="true">Plus卡特权日,精品课程秒杀价</text>
      </swiper-item>
    </swiper>
    <image src="{{imgUrl}}card/icon-arrow-right-white.png" class="arrow" bindtap="swiperNext"></image>
  </view>
  <button class="btn" bindtap="handleRechargeTap">立即开通</button>
</view>

<view class='officialAccount fadeIn animated' 
      wx:if='{{memberFollowState == 0}}'>
  <official-account bindload='bindload' 
                    binderror='binderror'
                    class='officialAccount'>
  </official-account>
</view>
<officalAccount memberFollowState='{{memberFollowState}}' 
                officialData= '{{officialData}}'
                officialDataState='{{officialDataState}}'
                pageShowNoticeState='{{memberInfo.sub_flag == 0 && memberInfo.order_count > 1 ? true : false}}'>
</officalAccount>